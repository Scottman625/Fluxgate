<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxgate Queue Basic Usage</title>
    <link rel="stylesheet" href="../styles/queue-widget.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 40px 20px;
            background: #f8fafc;
            min-height: 100vh;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .demo-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .demo-section {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .demo-section h3 {
            margin-top: 0;
            color: #1f2937;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .controls button {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        .controls button:hover {
            background: #f9fafb;
        }

        .controls button.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .log {
            background: #1f2937;
            color: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 4px;
        }

        .log-entry .timestamp {
            color: #9ca3af;
        }

        .log-entry .level-info {
            color: #60a5fa;
        }

        .log-entry .level-success {
            color: #34d399;
        }

        .log-entry .level-error {
            color: #f87171;
        }
    </style>
</head>

<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>Fluxgate Queue JavaScript SDK Examples</h1>
            <p>展示不同的配置和使用方式</p>
        </div>

        <div class="demo-grid">
            <!-- 基本使用示例 -->
            <div class="demo-section">
                <h3>基本使用</h3>
                <div class="controls">
                    <button onclick="basicDemo.enterQueue()">加入排隊</button>
                    <button onclick="basicDemo.refresh()">刷新狀態</button>
                    <button onclick="basicDemo.destroy()">銷毀組件</button>
                </div>
                <div id="basic-queue"></div>
                <div id="basic-log" class="log"></div>
            </div>

            <!-- 暗色主題示例 -->
            <div class="demo-section">
                <h3>暗色主題</h3>
                <div class="controls">
                    <button onclick="darkDemo.enterQueue()">加入排隊</button>
                    <button onclick="toggleLanguage()">切換語言</button>
                </div>
                <div id="dark-queue"></div>
                <div id="dark-log" class="log"></div>
            </div>

            <!-- SDK 直接使用示例 -->
            <div class="demo-section">
                <h3>SDK 直接使用</h3>
                <div class="controls">
                    <button onclick="sdkDemo.enter()">進入隊列</button>
                    <button onclick="sdkDemo.getStatus()">查詢狀態</button>
                    <button onclick="sdkDemo.stop()">停止輪詢</button>
                </div>
                <div id="sdk-status"></div>
                <div id="sdk-log" class="log"></div>
            </div>

            <!-- 多實例示例 -->
            <div class="demo-section">
                <h3>多活動示例</h3>
                <div class="controls">
                    <button onclick="multiDemo.switchActivity(1)">活動 1</button>
                    <button onclick="multiDemo.switchActivity(2)">活動 2</button>
                </div>
                <div id="multi-queue"></div>
                <div id="multi-log" class="log"></div>
            </div>
        </div>
    </div>

    <!-- 載入 SDK -->
    <script src="../sdk/queue-sdk.js"></script>
    <script src="../components/queue-widget.js"></script>

    <script>
        // 日誌工具
        function createLogger(containerId) {
            const container = document.getElementById(containerId);
            return {
                log: (level, message, data = null) => {
                    const entry = document.createElement('div');
                    entry.className = 'log-entry';

                    const timestamp = new Date().toLocaleTimeString();
                    const dataStr = data ? ` ${JSON.stringify(data)}` : '';

                    entry.innerHTML = `
                        <span class="timestamp">[${timestamp}]</span>
                        <span class="level-${level}">[${level.toUpperCase()}]</span>
                        ${message}${dataStr}
                    `;

                    container.appendChild(entry);
                    container.scrollTop = container.scrollHeight;

                    // 限制日誌條數
                    while (container.children.length > 50) {
                        container.removeChild(container.firstChild);
                    }
                }
            };
        }

        // 基本使用示例
        const basicDemo = (() => {
            const logger = createLogger('basic-log');
            let widget = null;

            function init() {
                widget = new QueueWidget('#basic-queue', {
                    apiBase: '/api/v1',
                    activityId: 1,
                    theme: 'light',
                    language: 'zh-TW'
                });

                // 監聽事件
                widget.sdk.on('entered', (data) => {
                    logger.log('success', '成功加入排隊', { seq: data.seq, position: data.position });
                });

                widget.sdk.on('statusUpdate', (data) => {
                    logger.log('info', '狀態更新', {
                        position: data.position,
                        eta: data.eta?.estimated_wait_seconds
                    });
                });

                widget.sdk.on('ready', (data) => {
                    logger.log('success', '可以進入了！', data);
                });

                widget.sdk.on('error', (error) => {
                    logger.log('error', '發生錯誤', { message: error.message });
                });
            }

            return {
                enterQueue: () => widget?.enterQueue(),
                refresh: () => widget?.refresh(),
                destroy: () => {
                    widget?.destroy();
                    widget = null;
                    logger.log('info', '組件已銷毀');
                    setTimeout(init, 1000); // 1秒後重新初始化
                }
            };
        })();

        // 暗色主題示例
        const darkDemo = (() => {
            const logger = createLogger('dark-log');
            let widget = null;
            let currentLang = 'zh-TW';

            function init() {
                widget = new QueueWidget('#dark-queue', {
                    apiBase: '/api/v1',
                    activityId: 1,
                    theme: 'dark',
                    language: currentLang,
                    showProgress: true,
                    showETA: true
                });

                widget.sdk.on('statusUpdate', (data) => {
                    logger.log('info', 'Status updated', data);
                });
            }

            window.toggleLanguage = () => {
                currentLang = currentLang === 'zh-TW' ? 'en' : 'zh-TW';
                widget?.destroy();
                init();
                logger.log('info', `語言切換至 ${currentLang}`);
            };

            return {
                enterQueue: () => widget?.enterQueue()
            };
        })();

        // SDK 直接使用示例
        const sdkDemo = (() => {
            const logger = createLogger('sdk-log');
            const statusContainer = document.getElementById('sdk-status');
            let sdk = null;

            function init() {
                sdk = new QueueSDK({
                    apiBase: '/api/v1',
                    activityId: 1
                });

                sdk.on('entered', (data) => {
                    logger.log('success', 'SDK: 進入隊列', data);
                    updateStatus();
                });

                sdk.on('statusUpdate', (data) => {
                    logger.log('info', 'SDK: 狀態更新', data);
                    updateStatus();
                });

                sdk.on('error', (error) => {
                    logger.log('error', 'SDK: 錯誤', error);
                    updateStatus();
                });
            }

            function updateStatus() {
                const status = sdk?.getStatus();
                statusContainer.innerHTML = `
                    <div style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                        <strong>SDK 狀態:</strong> ${status?.status || 'N/A'}<br>
                        <strong>位置:</strong> ${status?.queueData?.position || 'N/A'}<br>
                        <strong>序號:</strong> ${status?.queueData?.seq || 'N/A'}
                    </div>
                `;
            }

            return {
                enter: async () => {
                    try {
                        await sdk?.enterQueue();
                    } catch (error) {
                        logger.log('error', 'SDK: 進入失敗', error);
                    }
                },
                getStatus: async () => {
                    try {
                        const status = await sdk?.getQueueStatus();
                        logger.log('info', 'SDK: 查詢狀態', status);
                        updateStatus();
                    } catch (error) {
                        logger.log('error', 'SDK: 查詢失敗', error);
                    }
                },
                stop: () => {
                    sdk?.stopPolling();
                    logger.log('info', 'SDK: 停止輪詢');
                }
            };
        })();

        // 多實例示例
        const multiDemo = (() => {
            const logger = createLogger('multi-log');
            let widget = null;
            let currentActivity = 1;

            function init(activityId) {
                if (widget) {
                    widget.destroy();
                }

                widget = new QueueWidget('#multi-queue', {
                    apiBase: '/api/v1',
                    activityId: activityId,
                    theme: 'light',
                    autoEnter: true
                });

                widget.sdk.on('entered', (data) => {
                    logger.log('success', `活動 ${activityId}: 加入排隊`, data);
                });

                widget.sdk.on('statusUpdate', (data) => {
                    logger.log('info', `活動 ${activityId}: 狀態更新`, { position: data.position });
                });
            }

            return {
                switchActivity: (activityId) => {
                    if (currentActivity !== activityId) {
                        currentActivity = activityId;
                        init(activityId);
                        logger.log('info', `切換到活動 ${activityId}`);
                    }
                }
            };
        })();

        // 初始化所有示例
        document.addEventListener('DOMContentLoaded', () => {
            basicDemo.destroy(); // 觸發初始化
            darkDemo.enterQueue();
            sdkDemo.enter();
            multiDemo.switchActivity(1);
        });
    </script>
</body>

</html>